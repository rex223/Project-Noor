{% extends 'base.html' %}

{% block title %}NOOR - Your AI Companion{% endblock %}

{% block content %}
<div class="min-h-screen w-full" x-data="noorApp()">
    <!-- Desktop Header -->
    <header class="bg-gray-900/50 backdrop-blur-lg border-b border-gray-700/50 sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-3xl font-bold neon-text">NOOR</h1>
                    <span class="text-gray-400">Your Adaptive AI Companion</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="openChat()" class="btn-primary">üí¨ Chat</button>
                    <button @click="showNotifications = true" class="btn-secondary">üîî</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area with Sidebar -->
    <div class="flex h-screen pt-20">
        <!-- Left Sidebar - NOOR Character & Quick Actions -->
        <aside class="w-80 bg-gray-900/30 backdrop-blur-lg border-r border-gray-700/50 overflow-y-auto">
            <div class="p-6 space-y-6">
                <!-- NOOR Character Section -->
                <div class="text-center">
                    <div class="relative inline-block">
                        <div class="w-32 h-32 mx-auto mb-4 relative">
                            <div class="absolute inset-0 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 animate-pulse"></div>
                            <button @click="interactWithNoor()" 
                                    class="relative w-full h-full rounded-full bg-gray-800 border-4 border-gray-600 hover:border-purple-400 transition-all duration-300 text-6xl flex items-center justify-center transform hover:scale-105"
                                    x-bind:class="{ 'animate-bounce': isNoorTalking }">
                                <span x-text="noorExpression"></span>
                            </button>
                        </div>
                        <!-- Speech Bubble -->
                        <div x-show="noorMessage" 
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-start="opacity-0 scale-95"
                             x-transition:enter-end="opacity-100 scale-100"
                             class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-white text-gray-800 px-4 py-2 rounded-xl shadow-lg min-w-48 z-10">
                            <p x-text="noorMessage" class="text-sm font-medium"></p>
                            <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                                <div class="w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-white"></div>
                            </div>
                        </div>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Hello! I'm NOOR</h3>
                    <p class="text-gray-400 text-sm">Click me to say hi!</p>
                </div>

                <!-- Quick Actions -->
                <div class="space-y-3">
                    <h4 class="text-lg font-semibold">Quick Actions</h4>
                    <button @click="openChat()" class="w-full btn-primary text-left">üí¨ Start Conversation</button>
                    <button @click="showMediaSuggestions = true" class="w-full btn-secondary text-left">üéµ Get Media Suggestions</button>
                    <button @click="showGames = true" class="w-full btn-secondary text-left">üéÆ Play RPG Games</button>
                    <button @click="showMoodCheck = true" class="w-full btn-secondary text-left">üòä Mood Check-in</button>
                </div>

                <!-- Status Indicators -->
                <div class="space-y-3">
                    <h4 class="text-lg font-semibold">Your Status</h4>
                    <div class="glass-dark rounded-lg p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Mood</span>
                            <span class="text-green-400 text-sm" x-text="userMood"></span>
                        </div>
                    </div>
                    <div class="glass-dark rounded-lg p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Today's Progress</span>
                            <span class="text-blue-400 text-sm">75%</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto">
            <div class="container mx-auto px-6 py-8">
                
                <!-- Dashboard Cards Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
                    
                    <!-- Media Suggestions Card -->
                    <div class="lg:col-span-1 xl:col-span-1">
                        <div class="glass rounded-2xl p-6 h-full">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-semibold">üéµ Media for You</h2>
                                <div class="flex space-x-2">
                                    <button @click="mediaTab = 'music'" 
                                            x-bind:class="{ 'bg-purple-600': mediaTab === 'music', 'bg-gray-700': mediaTab !== 'music' }"
                                            class="px-3 py-1 rounded-lg text-sm">Music</button>
                                    <button @click="mediaTab = 'videos'" 
                                            x-bind:class="{ 'bg-purple-600': mediaTab === 'videos', 'bg-gray-700': mediaTab !== 'videos' }"
                                            class="px-3 py-1 rounded-lg text-sm">Videos</button>
                                </div>
                            </div>
                            <!-- Music Suggestions -->
                            <div class="space-y-3 max-h-80 overflow-y-auto" x-show="mediaTab === 'music'">
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all" 
                                     @click="playMedia('music', 'lofi-beats')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-lg">üéµ</div>
                                        <div>
                                            <h3 class="font-medium">Lofi Study Beats</h3>
                                            <p class="text-xs text-gray-400">Perfect for focus</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('music', 'upbeat-vibes')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center text-lg">üéß</div>
                                        <div>
                                            <h3 class="font-medium">Upbeat Vibes</h3>
                                            <p class="text-xs text-gray-400">Boost your mood</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('music', 'chill-ambient')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-blue-500 rounded-lg flex items-center justify-center text-lg">üåø</div>
                                        <div>
                                            <h3 class="font-medium">Chill Ambient</h3>
                                            <p class="text-xs text-gray-400">Relax and unwind</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Video Suggestions -->
                            <div class="space-y-3 max-h-80 overflow-y-auto" x-show="mediaTab === 'videos'">
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('video', 'mindfulness')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg flex items-center justify-center text-lg">üßò</div>
                                        <div>
                                            <h3 class="font-medium">Mindfulness Session</h3>
                                            <p class="text-xs text-gray-400">5-min guided meditation</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('video', 'motivation')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center text-lg">‚ö°</div>
                                        <div>
                                            <h3 class="font-medium">Daily Motivation</h3>
                                            <p class="text-xs text-gray-400">Inspiring content</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RPG Games Card -->
                    <div class="lg:col-span-1 xl:col-span-2">
                        <div class="glass rounded-2xl p-6 h-full">
                            <h2 class="text-xl font-semibold mb-4">üéÆ Interactive RPG Games</h2>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-80 overflow-y-auto">
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('personality-quest')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">üè∞</div>
                                        <h3 class="font-semibold mb-1">Personality Quest</h3>
                                        <p class="text-xs text-gray-400 mb-2">Discover your traits</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full" style="width: 30%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('mood-dungeon')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">üåü</div>
                                        <h3 class="font-semibold mb-1">Mood Dungeon</h3>
                                        <p class="text-xs text-gray-400 mb-2">Battle negative thoughts</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full" style="width: 60%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('social-arena')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">üë•</div>
                                        <h3 class="font-semibold mb-1">Social Arena</h3>
                                        <p class="text-xs text-gray-400 mb-2">Practice conversations</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-pink-500 to-purple-500 h-2 rounded-full" style="width: 45%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('mindfulness-mystery')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">üßò</div>
                                        <h3 class="font-semibold mb-1">Mindfulness Mystery</h3>
                                        <p class="text-xs text-gray-400 mb-2">Meditation puzzles</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-cyan-500 to-green-500 h-2 rounded-full" style="width: 20%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Feed & Recent Interactions -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Recent Activity -->
                    <div class="glass rounded-2xl p-6">
                        <h2 class="text-xl font-semibold mb-4">üìä Recent Activity</h2>
                        <div class="space-y-4 max-h-60 overflow-y-auto">
                            <div class="flex items-center space-x-3 p-3 glass-dark rounded-lg">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-sm">‚úì</div>
                                <div>
                                    <p class="text-sm font-medium">Completed Mood Check-in</p>
                                    <p class="text-xs text-gray-400">2 hours ago</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 glass-dark rounded-lg">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-sm">üéµ</div>
                                <div>
                                    <p class="text-sm font-medium">Listened to Lofi Beats</p>
                                    <p class="text-xs text-gray-400">4 hours ago</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 glass-dark rounded-lg">
                                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-sm">üéÆ</div>
                                <div>
                                    <p class="text-sm font-medium">Started Personality Quest</p>
                                    <p class="text-xs text-gray-400">Yesterday</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Insights & Tips -->
                    <div class="glass rounded-2xl p-6">
                        <h2 class="text-xl font-semibold mb-4">üí° Insights & Tips</h2>
                        <div class="space-y-4 max-h-60 overflow-y-auto">
                            <div class="glass-dark rounded-lg p-4">
                                <h3 class="font-medium mb-2">üåü Today's Insight</h3>
                                <p class="text-sm text-gray-300">You've been consistently checking in with your mood. This self-awareness is a key step in emotional growth!</p>
                            </div>
                            <div class="glass-dark rounded-lg p-4">
                                <h3 class="font-medium mb-2">üí™ Wellness Tip</h3>
                                <p class="text-sm text-gray-300">Try the 5-4-3-2-1 grounding technique: Name 5 things you see, 4 you can touch, 3 you hear, 2 you smell, 1 you taste.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bottom Search Bar (Fixed) -->
    <div class="fixed bottom-0 left-0 right-0 bg-gray-900/80 backdrop-blur-lg border-t border-gray-700/50 p-4 z-30">
        <div class="container mx-auto max-w-4xl">
            <div class="flex space-x-4">
                <div class="flex-1 relative">
                    <input x-model="searchQuery" 
                           @keyup.enter="processSearch()"
                           type="text" 
                           placeholder="Ask NOOR anything or search for content..."
                           class="w-full bg-gray-800/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 text-white placeholder-gray-400">
                    <button @click="processSearch()" 
                            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-purple-600 hover:bg-purple-700 rounded-lg px-4 py-2 text-sm font-medium transition-colors">
                        Search
                    </button>
                </div>
                <button @click="startVoiceInput()" 
                        class="bg-gray-800/50 hover:bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 text-white transition-colors">
                    üé§
                </button>
            </div>
            <!-- Quick Suggestions -->
            <div class="flex flex-wrap gap-2 mt-3">
                <button @click="searchQuery = 'play relaxing music'; processSearch()" 
                        class="px-3 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg text-sm transition-colors">üéµ Play Music</button>
                <button @click="searchQuery = 'how are you feeling today?'; processSearch()" 
                        class="px-3 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg text-sm transition-colors">üòä Mood Check</button>
                <button @click="searchQuery = 'suggest a game'; processSearch()" 
                        class="px-3 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg text-sm transition-colors">üéÆ Games</button>
                <button @click="openChat()" 
                        class="px-3 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg text-sm transition-colors">üí¨ Chat</button>
            </div>
        </div>
    </div>
                            
                            <div class="media-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow"
                                 @click="playMedia('music', 'chill-ambient')">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-teal-500 rounded-lg flex items-center justify-center">
                                        üåä
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">Chill Ambient</h3>
                                        <p class="text-sm text-gray-400">Relax and unwind</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Video Suggestions -->
                        <div class="space-y-4" x-show="mediaTab === 'videos'">
                            <div class="media-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow"
                                 @click="playMedia('video', 'mindfulness')">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg flex items-center justify-center">
                                        üßò
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">Mindfulness Videos</h3>
                                        <p class="text-sm text-gray-400">5-min meditation</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="media-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow"
                                 @click="playMedia('video', 'motivation')">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center">
                                        ‚ö°
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">Motivation Boost</h3>
                                        <p class="text-sm text-gray-400">Daily inspiration</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Media Type Toggle -->
                        <div class="flex space-x-2 mt-6">
                            <button @click="mediaTab = 'music'" 
                                    :class="mediaTab === 'music' ? 'bg-blue-600' : 'bg-gray-600'"
                                    class="flex-1 py-2 px-4 rounded-lg transition-colors">
                                Music
                            </button>
                            <button @click="mediaTab = 'videos'" 
                                    :class="mediaTab === 'videos' ? 'bg-blue-600' : 'bg-gray-600'"
                                    class="flex-1 py-2 px-4 rounded-lg transition-colors">
                                Videos
                            </button>
                        </div>
                        
                    <!-- Center Panel - NOOR Character -->
                    <div class="flex flex-col items-center justify-center space-y-8">
                        <!-- NOOR Character -->
                        <div class="relative">
                            <div class="w-64 h-64 rounded-full glass neon-glow pulse-glow flex items-center justify-center cursor-pointer float-animation"
                                 @click="interactWithNoor()"
                                 :class="noorMood">
                                <div class="text-8xl" x-text="noorFace"></div>
                            </div>
                            
                            <!-- Speech bubble -->
                            <div x-show="showSpeechBubble" 
                                 x-transition:enter="transition ease-out duration-300"
                                 x-transition:enter-start="opacity-0 scale-90"
                                 x-transition:enter-end="opacity-1 scale-100"
                                 class="absolute -top-20 left-1/2 transform -translate-x-1/2 bg-white text-gray-800 px-4 py-2 rounded-lg shadow-lg">
                                <p x-text="currentMessage"></p>
                                <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-white"></div>
                            </div>
                        </div>
                        
                        <!-- NOOR Status -->
                        <div class="text-center space-y-2">
                            <h3 class="text-2xl font-semibold" x-text="noorStatus"></h3>
                            <p class="text-gray-400" x-text="noorSubtitle"></p>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="flex space-x-4">
                            <button @click="startChat()" 
                                    class="glass px-6 py-3 rounded-full hover:neon-glow transition-all">
                                üí¨ Chat
                            </button>
                            <button @click="openGames()" 
                                    class="glass px-6 py-3 rounded-full hover:neon-glow transition-all">
                                üéÆ Games
                            </button>
                            <button @click="checkMood()" 
                                    class="glass px-6 py-3 rounded-full hover:neon-glow transition-all">
                                üß† Mood Check
                            </button>
                        </div>
                    </div>
                    
                    <!-- Right Panel - RPG Games -->
                    <div class="glass rounded-3xl p-6 space-y-6">
                        <h2 class="text-2xl font-semibold mb-6 text-center">üéÆ RPG Adventures</h2>
                        
                        <div class="space-y-4">
                            <div class="glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow"
                                 @click="playGame('personality-quest')">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
                                        üè∞
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">Personality Quest</h3>
                                        <p class="text-sm text-gray-400">Discover your traits</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div class="bg-blue-500 h-2 rounded-full" style="width: 45%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow"
                                 @click="playGame('mood-dungeon')">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-cyan-500 rounded-lg flex items-center justify-center">
                                        üåü
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">Mood Dungeon</h3>
                                        <p class="text-sm text-gray-400">Battle negative thoughts</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 70%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow"
                                 @click="playGame('social-arena')">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-red-500 rounded-lg flex items-center justify-center">
                                        üë•
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">Social Arena</h3>
                                        <p class="text-sm text-gray-400">Practice conversations</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div class="bg-pink-500 h-2 rounded-full" style="width: 20%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow"
                                 @click="playGame('stress-survival')">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-lg flex items-center justify-center">
                                        ‚öîÔ∏è
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">Stress Survival</h3>
                                        <p class="text-sm text-gray-400">Master coping skills</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div class="bg-orange-500 h-2 rounded-full" style="width: 60%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Achievement Badge -->
                        <div class="mt-6 p-4 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üèÜ</span>
                                <div>
                                    <h4 class="font-semibold">Latest Achievement</h4>
                                    <p class="text-sm">Mood Master - 7 day streak!</p>
                                </div>
                            </div>
                        </div>
                    </div>
        
        <!-- Bottom Search Bar -->
        <div class="p-8">
            <div class="max-w-4xl mx-auto">
                <div class="relative">
                    <input type="text" 
                           x-model="searchQuery"
                           @keyup.enter="performSearch()"
                           placeholder="Ask NOOR anything... üí≠"
                           class="w-full py-4 px-6 pr-16 bg-black bg-opacity-30 border border-gray-600 rounded-full text-white placeholder-gray-400 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 backdrop-blur-lg">
                    
                    <button @click="performSearch()" 
                            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Quick suggestions -->
                <div class="flex flex-wrap gap-2 mt-4 justify-center">
                    <span @click="searchQuery = 'How are you feeling today?'; performSearch()" 
                          class="px-4 py-2 bg-gray-700 bg-opacity-50 rounded-full text-sm cursor-pointer hover:bg-gray-600 transition-colors">
                        How are you feeling?
                    </span>
                    <span @click="searchQuery = 'Play some music'; performSearch()" 
                          class="px-4 py-2 bg-gray-700 bg-opacity-50 rounded-full text-sm cursor-pointer hover:bg-gray-600 transition-colors">
                        Play music
                    </span>
                    <span @click="searchQuery = 'Start a game'; performSearch()" 
                          class="px-4 py-2 bg-gray-700 bg-opacity-50 rounded-full text-sm cursor-pointer hover:bg-gray-600 transition-colors">
                        Start a game
                    </span>
                    <span @click="searchQuery = 'Tell me a joke'; performSearch()" 
                          class="px-4 py-2 bg-gray-700 bg-opacity-50 rounded-full text-sm cursor-pointer hover:bg-gray-600 transition-colors">
                        Tell me a joke
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Chat Modal -->
    <div x-show="showChatModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-1"
         class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
        
        <div class="w-full max-w-2xl h-3/4 glass rounded-2xl flex flex-col">
            <!-- Chat Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-600">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center">
                        <span class="text-lg">ü§ñ</span>
                    </div>
                    <div>
                        <h3 class="font-semibold">NOOR</h3>
                        <p class="text-sm text-gray-400">Your AI Companion</p>
                    </div>
                </div>
                <button @click="showChatModal = false" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Chat Messages -->
            <div class="flex-1 overflow-y-auto p-6 space-y-4">
                <template x-for="message in chatMessages" :key="message.id">
                    <div :class="message.sender === 'user' ? 'flex justify-end' : 'flex justify-start'">
                        <div :class="message.sender === 'user' ? 'bg-blue-600' : 'bg-gray-700'" 
                             class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg chat-bubble-enter">
                            <p class="text-sm" x-text="message.text"></p>
                            <p class="text-xs text-gray-300 mt-1" x-text="message.time"></p>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Chat Input -->
            <div class="p-6 border-t border-gray-600">
                <div class="flex space-x-3">
                    <input type="text" 
                           x-model="chatInput"
                           @keyup.enter="sendMessage()"
                           placeholder="Type your message..."
                           class="flex-1 py-3 px-4 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500">
                    <button @click="sendMessage()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function noorApp() {
    return {
        // NOOR Character State
        noorFace: 'üòä',
        noorMood: '',
        noorStatus: 'Hello! I\'m NOOR',
        noorSubtitle: 'Wave at me to say hi! üëã',
        currentMessage: 'Hi there! I\'m excited to meet you!',
        showSpeechBubble: true,
        
        // Interface State
        mediaTab: 'music',
        searchQuery: '',
        showChatModal: false,
        chatInput: '',
        chatMessages: [
            {
                id: 1,
                sender: 'noor',
                text: 'Hi! I\'m NOOR, your personal AI companion. How are you feeling today?',
                time: '12:00 PM'
            }
        ],
        
        // Initialize
        init() {
            this.welcomeSequence();
            this.hideSpeechBubbleAfterDelay();
        },
        
        // Welcome animation
        welcomeSequence() {
            setTimeout(() => {
                this.noorFace = 'üëã';
                this.currentMessage = 'Welcome to our space!';
                this.showSpeechBubble = true;
                this.hideSpeechBubbleAfterDelay();
            }, 2000);
        },
        
        // NOOR Interactions
        interactWithNoor() {
            const reactions = [
                { face: 'üòÜ', message: 'That tickles!', mood: 'face-excited' },
                { face: 'üòä', message: 'I love spending time with you!', mood: 'face-happy' },
                { face: 'ü§î', message: 'What should we do today?', mood: 'face-thinking' },
                { face: 'üòç', message: 'You\'re awesome!', mood: 'face-excited' },
                { face: 'ü§ó', message: 'Virtual hug!', mood: 'face-happy' }
            ];
            
            const reaction = reactions[Math.floor(Math.random() * reactions.length)];
            this.noorFace = reaction.face;
            this.currentMessage = reaction.message;
            this.noorMood = reaction.mood;
            this.showSpeechBubble = true;
            
            // Reset after animation
            setTimeout(() => {
                this.noorMood = '';
                this.noorFace = 'üòä';
            }, 2000);
            
            this.hideSpeechBubbleAfterDelay();
        },
        
        hideSpeechBubbleAfterDelay() {
            setTimeout(() => {
                this.showSpeechBubble = false;
            }, 3000);
        },
        
        // Media Functions
        playMedia(type, id) {
            this.noorFace = 'üéµ';
            this.currentMessage = `Playing ${type} for you!`;
            this.showSpeechBubble = true;
            this.hideSpeechBubbleAfterDelay();
            
            // Here you would integrate with actual media players
            console.log(`Playing ${type}: ${id}`);
        },
        
        // Game Functions
        playGame(gameId) {
            this.noorFace = 'üéÆ';
            this.currentMessage = 'Let\'s play together!';
            this.showSpeechBubble = true;
            this.hideSpeechBubbleAfterDelay();
            
            // Redirect to game
            window.location.href = `/games/${gameId}/`;
        },
        
        openGames() {
            window.location.href = '/games/';
        },
        
        // Chat Functions
        startChat() {
            this.showChatModal = true;
            this.noorFace = 'üí¨';
        },
        
        sendMessage() {
            if (!this.chatInput.trim()) return;
            
            // Add user message
            this.chatMessages.push({
                id: Date.now(),
                sender: 'user',
                text: this.chatInput,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });
            
            const userMessage = this.chatInput;
            this.chatInput = '';
            
            // Simulate NOOR response
            setTimeout(() => {
                this.addNoorResponse(userMessage);
            }, 1000);
        },
        
        addNoorResponse(userMessage) {
            const responses = {
                'hello': 'Hello! How can I help you today?',
                'how are you': 'I\'m doing great! Thanks for asking. How are you feeling?',
                'music': 'I\'d love to play some music for you! What genre do you prefer?',
                'game': 'Want to play a game? I have some fun personality quests we could try!',
                'joke': 'Why don\'t scientists trust atoms? Because they make up everything! üòÑ',
                'mood': 'Let\'s check in on your mood. On a scale of 1-10, how are you feeling?'
            };
            
            let response = 'That\'s interesting! Tell me more about how you\'re feeling.';
            
            for (let keyword in responses) {
                if (userMessage.toLowerCase().includes(keyword)) {
                    response = responses[keyword];
                    break;
                }
            }
            
            this.chatMessages.push({
                id: Date.now(),
                sender: 'noor',
                text: response,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });
        },
        
        // Search Function
        performSearch() {
            if (!this.searchQuery.trim()) return;
            
            this.noorFace = 'ü§î';
            this.currentMessage = 'Let me think about that...';
            this.showSpeechBubble = true;
            
            // Simulate search processing
            setTimeout(() => {
                this.processSearchQuery();
    <!-- Chat Modal -->
    <div x-show="showChat" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div @click.away="showChat = false" 
             class="bg-gray-900/90 backdrop-blur-lg rounded-2xl border border-gray-600/30 w-full max-w-2xl h-96 flex flex-col">
            <!-- Chat Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-600/30">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center">
                        <span x-text="noorExpression"></span>
                    </div>
                    <div>
                        <h3 class="font-semibold">NOOR</h3>
                        <p class="text-sm text-gray-400">Online</p>
                    </div>
                </div>
                <button @click="showChat = false" class="text-gray-400 hover:text-white text-xl">√ó</button>
            </div>
            
            <!-- Chat Messages -->
            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                <template x-for="message in chatMessages" :key="message.id">
                    <div x-bind:class="message.sender === 'user' ? 'flex justify-end' : 'flex justify-start'">
                        <div x-bind:class="message.sender === 'user' ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-100'"
                             class="max-w-xs px-4 py-2 rounded-2xl">
                            <p x-text="message.text" class="text-sm"></p>
                            <p x-text="message.time" class="text-xs opacity-70 mt-1"></p>
                        </div>
                    </div>
                </template>
                
                <!-- Typing Indicator -->
                <div x-show="isNoorTyping" class="flex justify-start">
                    <div class="bg-gray-700 text-gray-100 max-w-xs px-4 py-2 rounded-2xl">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="p-4 border-t border-gray-600/30">
                <div class="flex space-x-2">
                    <input x-model="chatInput" 
                           @keyup.enter="sendMessage()"
                           type="text" 
                           placeholder="Type a message..."
                           class="flex-1 bg-gray-800/50 border border-gray-600 rounded-xl px-4 py-2 focus:outline-none focus:border-purple-500 text-white placeholder-gray-400">
                    <button @click="sendMessage()" 
                            class="bg-purple-600 hover:bg-purple-700 rounded-xl px-4 py-2 text-white transition-colors">
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
function noorApp() {
    return {
        // Display states
        showChat: false,
        showNotifications: false,
        mediaTab: 'music',
        
        // NOOR character
        noorExpression: 'üòä',
        noorMessage: '',
        isNoorTalking: false,
        userMood: 'Happy',
        
        // Search
        searchQuery: '',
        
        // Chat system
        chatMessages: [
            {
                id: 1,
                sender: 'noor',
                text: 'Hello! I\'m NOOR, your adaptive AI companion. How can I help you today?',
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            }
        ],
        chatInput: '',
        isNoorTyping: false,
        
        // Initialize
        init() {
            this.noorExpression = 'üòä';
            // Add some welcome interactions
            setTimeout(() => {
                this.showWelcomeMessage();
            }, 2000);
        },
        
        showWelcomeMessage() {
            this.noorMessage = 'Welcome! Click me to say hi! üëã';
            setTimeout(() => {
                this.noorMessage = '';
            }, 3000);
        },
        
        // NOOR Interactions
        interactWithNoor() {
            const reactions = [
                { expression: 'üòÑ', message: 'That tickles! Hehe!' },
                { expression: 'ü§ó', message: 'Virtual hug incoming!' },
                { expression: 'üòä', message: 'Hi there! How are you?' },
                { expression: 'üòé', message: 'You\'re awesome!' },
                { expression: 'ü•∞', message: 'You made my day!' },
                { expression: 'üéâ', message: 'Woohoo! Let\'s have fun!' }
            ];
            
            const reaction = reactions[Math.floor(Math.random() * reactions.length)];
            this.noorExpression = reaction.expression;
            this.noorMessage = reaction.message;
            this.isNoorTalking = true;
            
            setTimeout(() => {
                this.isNoorTalking = false;
                this.noorExpression = 'üòä';
                this.noorMessage = '';
            }, 3000);
        },
        
        // Media functions
        playMedia(type, item) {
            if (type === 'music') {
                this.noorExpression = 'üéµ';
                this.noorMessage = `Playing ${item.replace('-', ' ')}! üé∂`;
            } else {
                this.noorExpression = 'üì∫';
                this.noorMessage = `Starting ${item} video! üé¨`;
            }
            
            setTimeout(() => {
                this.noorExpression = 'üòä';
                this.noorMessage = '';
            }, 3000);
        },
        
        // Game functions
        selectGame(gameId) {
            this.noorExpression = 'üéÆ';
            this.noorMessage = 'Let\'s start this adventure!';
            
            setTimeout(() => {
                window.location.href = `/games/${gameId}/`;
            }, 1500);
        },
        
        // Chat functions
        openChat() {
            this.showChat = true;
        },
        
        sendMessage() {
            if (!this.chatInput.trim()) return;
            
            const userMessage = {
                id: Date.now(),
                sender: 'user',
                text: this.chatInput,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            this.chatMessages.push(userMessage);
            this.chatInput = '';
            
            // Show typing indicator
            this.isNoorTyping = true;
            
            // Generate NOOR response
            setTimeout(() => {
                this.generateNoorResponse(userMessage.text);
                this.isNoorTyping = false;
            }, 1500);
        },
        
        generateNoorResponse(userText) {
            const text = userText.toLowerCase();
            let response = '';
            let expression = 'üòä';
            
            if (text.includes('sad') || text.includes('down') || text.includes('upset')) {
                response = 'I\'m sorry you\'re feeling that way. Would you like to try some calming music or a mindfulness exercise?';
                expression = 'ü§ó';
            } else if (text.includes('happy') || text.includes('great') || text.includes('good')) {
                response = 'That\'s wonderful! I love hearing when you\'re doing well. What\'s making you happy today?';
                expression = 'ÔøΩ';
            } else if (text.includes('music') || text.includes('song')) {
                response = 'I\'d love to help you find some music! Check out the media suggestions on the left. What genre are you in the mood for?';
                expression = 'üéµ';
            } else if (text.includes('game') || text.includes('play')) {
                response = 'Games are fun! I have some RPG games that can help with personal growth. Want to try Personality Quest or Mood Dungeon?';
                expression = 'üéÆ';
            } else if (text.includes('help') || text.includes('support')) {
                response = 'I\'m here to support you! I can suggest music, guide you through games, or just chat. What would help you most right now?';
                expression = 'ÔøΩ';
            } else {
                response = 'That\'s interesting! Tell me more about that. I\'m here to listen and help however I can.';
                expression = 'ü§î';
            }
            
            const noorMessage = {
                id: Date.now(),
                sender: 'noor',
                text: response,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            this.chatMessages.push(noorMessage);
            this.noorExpression = expression;
        },
        
        // Search functions
        processSearch() {
            if (!this.searchQuery.trim()) return;
            
            const query = this.searchQuery.toLowerCase();
            
            if (query.includes('music') || query.includes('song') || query.includes('play')) {
                this.mediaTab = 'music';
                this.noorExpression = 'üéµ';
                this.noorMessage = 'Here\'s some great music for you!';
            } else if (query.includes('video')) {
                this.mediaTab = 'videos';
                this.noorExpression = 'üì∫';
                this.noorMessage = 'Check out these videos!';
            } else if (query.includes('game')) {
                this.noorExpression = 'üéÆ';
                this.noorMessage = 'Let\'s explore some games!';
            } else if (query.includes('mood') || query.includes('feeling')) {
                this.noorExpression = 'üòä';
                this.noorMessage = 'How are you feeling today?';
            } else {
                this.openChat();
                this.chatInput = this.searchQuery;
                this.noorExpression = 'üí¨';
                this.noorMessage = 'Let\'s chat about that!';
            }
            
            setTimeout(() => {
                this.noorExpression = 'üòä';
                this.noorMessage = '';
            }, 3000);
            
            this.searchQuery = '';
        },
        
        // Voice input
        startVoiceInput() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = (event) => {
                    this.searchQuery = event.results[0][0].transcript;
                    this.processSearch();
                };
                
                recognition.start();
                this.noorExpression = 'üé§';
                this.noorMessage = 'Listening...';
                
                setTimeout(() => {
                    this.noorExpression = 'üòä';
                    this.noorMessage = '';
                }, 3000);
            } else {
                this.noorMessage = 'Voice input not supported in this browser';
                setTimeout(() => {
                    this.noorMessage = '';
                }, 3000);
            }
        }
    }
}
</script>
{% endblock %}
